<div class="book-detail-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-content">
      <div class="loading-spinner">
        üìö
      </div>
      <h3>{{ 'BOOK_DETAIL_LOADING' | translate }}</h3>
      <p>{{ 'PLEASE_WAIT' | translate }}</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-state">
    <div class="error-content">
      <div class="error-icon">
        ‚ö†Ô∏è
      </div>
      <h3>{{ 'BOOK_DETAIL_ERROR_TITLE' | translate }}</h3>
      <p>{{ error }}</p>
      <div class="error-actions">
        <button class="retry-button" (click)="retry()">
          üîÑ
          {{ 'RETRY' | translate }}
        </button>
        <button class="back-button" (click)="goBack()">
          ‚Üê
          {{ 'BOOK_DETAIL_GO_BACK' | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- Book Detail Content -->
  <div *ngIf="book && !isLoading && !error" class="book-detail-content">
    <!-- UNAVAILABLE MESSAGE -->
    <div *ngIf="!book.isAvailable" class="unavailable-message" [class.borrowed-by-you-message]="bookStatus?.isBorrowedByUser">
      <div *ngIf="bookStatus?.isBorrowedByUser; else otherUserBorrowed">
        <h2>{{ 'UNAVAILABLE_MESSAGE_BORROWED_BY_YOU' | translate }}</h2>
        <a [routerLink]="['/', translate.currentLang, 'dashboard']">{{ 'GO_TO_LIBRARY' | translate }}</a>
      </div>
      <ng-template #otherUserBorrowed>
        <h2>{{ 'UNAVAILABLE_MESSAGE_TITLE' | translate }}</h2>
        <p>{{ 'UNAVAILABLE_MESSAGE_BODY' | translate }}</p>
      </ng-template>
    </div>

    <!-- Header Section -->
    <div class="page-header">
      <div class="header-content">
        <div class="header-left">
          <button class="back-button" (click)="goBack()">
            ‚Üê
            <span>{{ 'BOOK_DETAIL_BACK_TO_BOOKS' | translate }}</span>
          </button>
        </div>
        <div class="header-center">
          <h1 class="page-title">
          </h1>
        </div>
      </div>
    </div>

    <!-- Book Information Section -->
    <div class="content-section">
      <div class="book-information">
        <!-- Book Cover and Basic Info -->
        <div class="book-hero">
          <div class="book-cover">
            <div *ngIf="coverImageUrl" class="cover-image" (click)="openImageModal()">
              <img [src]="coverImageUrl" [alt]="book.title" class="book-cover-img">
            </div>
            <div *ngIf="!coverImageUrl" class="cover-placeholder">
              <div class="placeholder-icon">üìö</div>
            </div>
          </div>
          
          <div class="book-info">
            <div class="book-title-section">
              <h2 class="book-title">{{ book.title }}</h2>
              <div class="book-meta">
              <a class="author-link" (click)="goToAuthorDetail(book.authorId)">
                    {{ book.authorName }}
                  </a>
                <span class="separator" *ngIf="book.authorName && book.publicationYear">‚Ä¢</span>
                <span class="year" *ngIf="book.publicationYear">{{ book.publicationYear }}</span>
                <span class="separator" *ngIf="book.publisherName">‚Ä¢</span>

                <a class="publisher-link" (click)="goToPublisherDetail(book.publisherId)">
                    {{ book.publisherName }}
                  </a>
              </div>
            </div>

            <div class="book-status">
              <span class="status-badge" [class.available]="book.isAvailable" [class.unavailable]="!book.isAvailable">
                {{ book.isAvailable ? ('AVAILABLE' | translate) : ('UNAVAILABLE' | translate) }}
              </span>
            </div>

            <!-- Return Date Information -->
            <div *ngIf="bookStatus?.isBorrowedByUser && bookStatus?.returnDate" class="return-info">
              <div class="return-date">
                <span class="return-label">üìÖ {{ 'RETURN_DATE' | translate }}:</span>
                <span class="return-date-value" [class.overdue]="bookStatus?.isOverdue" [class.warning]="!bookStatus?.isOverdue && (bookStatus?.remainingDays ?? 0) <= 3">
                  {{ bookStatus?.returnDate | date:'dd/MM/yyyy' }}
                </span>
              </div>
              <div class="remaining-time" [class.overdue]="bookStatus?.isOverdue" [class.warning]="!bookStatus?.isOverdue && (bookStatus?.remainingDays ?? 0) <= 3">
                <span *ngIf="bookStatus?.isOverdue && bookStatus?.remainingDays !== undefined" class="overdue-text">
                  ‚ö†Ô∏è {{ 'OVERDUE' | translate }} {{ -((bookStatus?.remainingDays ?? 0)) }} {{ 'DAYS_AGO' | translate }}
                </span>
                <span *ngIf="!bookStatus?.isOverdue && bookStatus?.remainingDays !== undefined" class="remaining-text">
                  ‚è∞ {{ 'REMAINING_DAYS' | translate }}: {{ (bookStatus?.remainingDays ?? 0) }} {{ 'DAYS' | translate }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Book Actions -->
        <div class="book-actions">
          <!-- Giri≈ü yapmamƒ±≈ü kullanƒ±cƒ±lar i√ßin borrow butonu -->
          <button 
            *ngIf="!checkIfUserLoggedIn() && book.isAvailable"
            class="borrow-button" 
            (click)="borrowBook()"
          >
            <span>üìñ</span>
            <span>{{ 'BOOK_DETAIL_BORROW' | translate }}</span>
          </button>
          
          <!-- Giri≈ü yapmƒ±≈ü kullanƒ±cƒ±lar i√ßin borrow/return butonlarƒ± -->
          <button 
            *ngIf="checkIfUserLoggedIn() && book.isAvailable && bookStatus && !bookStatus.isBorrowedByUser"
            class="borrow-button" 
            [disabled]="isBorrowing"
            (click)="borrowBook()"
          >
            <span *ngIf="!isBorrowing">üìñ</span>
            <span *ngIf="isBorrowing">‚è≥</span>
            <span>{{ isBorrowing ? ('BORROWING' | translate) : ('BOOK_DETAIL_BORROW' | translate) }}</span>
          </button>
          
          <button 
            *ngIf="checkIfUserLoggedIn() && bookStatus && bookStatus.isBorrowedByUser"
            class="return-button" 
            [disabled]="isBorrowing"
            (click)="returnBook()"
          >
            <span *ngIf="!isBorrowing">‚Ü©Ô∏è</span>
            <span *ngIf="isBorrowing">‚è≥</span>
            <span>{{ isBorrowing ? ('RETURNING' | translate) : ('BOOK_DETAIL_RETURN' | translate) }}</span>
          </button>
          
          <button 
            class="favorite-button" 
            [class.favorited]="isInFavorites"
            [disabled]="isAddingToFavorites"
            (click)="toggleFavorite()"
          >
            <span *ngIf="!isAddingToFavorites && !isInFavorites">ü§ç</span>
            <span *ngIf="!isAddingToFavorites && isInFavorites">‚ù§Ô∏è</span>
            <span *ngIf="isAddingToFavorites">‚è≥</span>
            <span>{{ isInFavorites ? ('REMOVE_FROM_FAVORITES' | translate) : ('BOOK_DETAIL_ADD_FAVORITES' | translate) }}</span>
          </button>
          
          <button class="share-button">
            <span>üì§</span>
            <span>{{ 'BOOK_DETAIL_SHARE' | translate }}</span>
          </button>
        </div>
      </div>

      <!-- Book Details Section -->
      <div class="book-details">
        <div class="detail-card">
          <div class="detail-header">
            <h3>üìã {{ 'BOOK_DETAIL_ ' | translate }}</h3>
          </div>
          <div class="detail-content">
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">üìñ {{ 'BOOK_DETAIL_TITLE' | translate }}:</span>
                <span class="detail-value">{{ book.title }}</span>
              </div>
              
              <div class="detail-item" *ngIf="book.publicationYear">
                <span class="detail-label">üìÖ {{ 'PUBLICATION_YEAR' | translate }}:</span>
                <span class="detail-value">{{ book.publicationYear }}</span>
              </div>
              
              <div class="detail-item" *ngIf="book.authorName">
                <span class="detail-label">üë§ {{ 'AUTHOR' | translate }}:</span>
                <span class="detail-value">
                  <a class="author-link" (click)="goToAuthorDetail(book.authorId)">
                    {{ book.authorName }}
                  </a>
                </span>
              </div>
              
              <div class="detail-item" *ngIf="book.publisherName">
                <span class="detail-label">üè¢ {{ 'PUBLISHER' | translate }}:</span>
                <span class="detail-value">
                  <a class="publisher-link" (click)="goToPublisherDetail(book.publisherId)">
                    {{ book.publisherName }}
                  </a>
                </span>
              </div>
              
              <div class="detail-item">
                <span class="detail-label">üìä {{ 'BOOK_DETAIL_STATUS' | translate }}:</span>
                <span class="detail-value" [class.available]="book.isAvailable" [class.unavailable]="!book.isAvailable">
                  {{ book.isAvailable ? ('AVAILABLE' | translate) : ('UNAVAILABLE' | translate) }}
                </span>
              </div>
              
              <div class="detail-item">
                <span class="detail-label">üÜî {{ 'BOOK_DETAIL_BOOK_ID' | translate }}:</span>
                <span class="detail-value">#{{ book.bookId }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Related Books Section -->
      <div class="related-books">
        <div class="section-header">
          <div class="section-title">
            <h3>üìö {{ 'BOOK_DETAIL_RELATED_BOOKS' | translate }}</h3>
          </div>
        </div>
        <div class="related-books-placeholder">
          <div class="empty-content">
            <div class="empty-icon">
              üìö
            </div>
            <h4>{{ 'BOOK_DETAIL_NO_RELATED_BOOKS' | translate }}</h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Modal -->
  <div *ngIf="showImageModal" class="image-modal" (click)="onModalClick($event)">
    <div class="modal-content">
      <button class="modal-close" (click)="closeImageModal()">
        ‚úï
      </button>
      <img *ngIf="coverImageUrl" [src]="coverImageUrl" [alt]="book?.title" class="modal-image">
    </div>
  </div>
</div> 