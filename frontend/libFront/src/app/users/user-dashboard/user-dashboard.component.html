<div class="dashboard-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <button class="btn btn-back" (click)="goBack()">
          <i class="fas fa-arrow-left"></i>
          <span>{{ 'BACK' | translate }}</span>
        </button>
      </div>
      <div class="header-center">
        <h1 class="page-title">
          <i class="fas fa-user-circle"></i>
          {{ 'MY_LIBRARY' | translate }}
        </h1>
        <p class="page-subtitle">{{ 'MY_LIBRARY_DESCRIPTION' | translate }}</p>
      </div>
      <div class="header-right">
        <button class="btn btn-primary" (click)="retry()" *ngIf="error">
          <i class="fas fa-redo"></i>
          <span>{{ 'RETRY' | translate }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-content">
      <div class="loading-spinner">
        <i class="fas fa-book fa-pulse"></i>
      </div>
      <h3>{{ 'LOADING_MY_LIBRARY' | translate }}</h3>
      <p>{{ 'PLEASE_WAIT' | translate }}</p>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error && !isLoading">
    <div class="error-content">
      <div class="error-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3>{{ 'ERROR_LOADING_MY_LIBRARY' | translate }}</h3>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="retry()">
        <i class="fas fa-redo"></i>
        {{ 'RETRY' | translate }}
      </button>
    </div>
  </div>

  <!-- Content Section -->
  <div class="content-section" *ngIf="!isLoading && !error">
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'favorites'"
        (click)="setActiveTab('favorites')"
      >
        <i class="fas fa-heart"></i>
        <span>{{ 'FAVORITES' | translate }}</span>
        <span class="tab-count" *ngIf="favoriteBooks.length > 0">{{ favoriteBooks.length }}</span>
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'borrowed'"
        (click)="setActiveTab('borrowed')"
      >
        <i class="fas fa-book-reader"></i>
        <span>{{ 'BORROWED_BOOKS' | translate }}</span>
        <span class="tab-count" *ngIf="borrowedBooks.length > 0">{{ borrowedBooks.length }}</span>
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Favorites Tab -->
      <div class="tab-panel" [class.active]="activeTab === 'favorites'">
        <div class="panel-header">
          <div class="section-title">
            <h2>{{ 'FAVORITES' | translate }}</h2>
            <span class="item-count">{{ favoriteBooks.length }} {{ 'FAVORITE_BOOKS' | translate }}</span>
          </div>
        </div>

        <div class="books-section" *ngIf="favoriteBooks.length > 0">
          <div class="books-list">
            <div class="book-row" *ngFor="let book of favoriteBooks">
              <!-- Book Cover -->
              <div class="book-cover">
                <div class="cover-image" *ngIf="book.hasCoverImage">
                  <img [src]="getBookCoverUrl(book.bookId)"
                       [alt]="book.title"
                       class="book-cover-img"
                       (error)="hideImage($event)">
                </div>
                <div class="cover-placeholder" *ngIf="!book.hasCoverImage">
                  <i class="fas fa-book"></i>
                </div>
              </div>

              <!-- Book Info -->
              <div class="book-info">
                <div class="book-title-section">
                  <h3 class="book-title" (click)="goToBookDetail(book.bookId)">
                    {{ book.title }}
                  </h3>
                  <div class="book-meta">
                    <span class="author" *ngIf="book.authorName">{{ book.authorName }}</span>
                    <span class="separator" *ngIf="book.authorName && book.publicationYear">•</span>
                    <span class="year" *ngIf="book.publicationYear">{{ book.publicationYear }}</span>
                    <span class="separator" *ngIf="book.publisherName">•</span>
                    <span class="publisher" *ngIf="book.publisherName">{{ book.publisherName }}</span>
                  </div>
                </div>

                <div class="book-status">
                  <span class="status-badge" [class.available]="book.isAvailable" [class.unavailable]="!book.isAvailable">
                    {{ book.isAvailable ? ('AVAILABLE' | translate) : ('UNAVAILABLE' | translate) }}
                  </span>
                </div>
              </div>

              <!-- Book Actions -->
              <div class="book-actions">
                <button class="btn btn-outline" (click)="goToBookDetail(book.bookId)">
                  <i class="fas fa-eye"></i>
                  <span>{{ 'VIEW_DETAILS' | translate }}</span>
                </button>
                <button class="btn btn-danger" (click)="removeFromFavorites(book.bookId)">
                  <i class="fas fa-heart-broken"></i>
                  <span>{{ 'REMOVE' | translate }}</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty Favorites State -->
        <div class="empty-state" *ngIf="favoriteBooks.length === 0">
          <div class="empty-content">
            <div class="empty-icon">
              <i class="fas fa-heart"></i>
            </div>
            <h3>{{ 'NO_FAVORITES' | translate }}</h3>
            <p>{{ 'NO_FAVORITES_DESCRIPTION' | translate }}</p>
            <div class="empty-actions">
              <button class="btn btn-primary" (click)="goBack()">
                <i class="fas fa-search"></i>
                {{ 'BROWSE_BOOKS' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Borrowed Books Tab -->
      <div class="tab-panel" [class.active]="activeTab === 'borrowed'">
        <div class="panel-header">
          <div class="section-title">
            <h2>{{ 'BORROWED_BOOKS' | translate }}</h2>
            <span class="item-count">{{ borrowedBooks.length }} {{ 'BORROWED_BOOKS' | translate }}</span>
          </div>
        </div>

        <div class="books-section" *ngIf="borrowedBooks.length > 0">
          <div class="books-list">
            <div class="book-row" *ngFor="let book of borrowedBooks">
              <!-- Book Cover -->
              <div class="book-cover">
                <div class="cover-image" *ngIf="book.hasCoverImage">
                  <img [src]="getBookCoverUrl(book.bookId)"
                       [alt]="book.title"
                       class="book-cover-img"
                       (error)="hideImage($event)">
                </div>
                <div class="cover-placeholder" *ngIf="!book.hasCoverImage">
                  <i class="fas fa-book"></i>
                </div>
              </div>

              <!-- Book Info -->
              <div class="book-info">
                <div class="book-title-section">
                  <h3 class="book-title" (click)="goToBookDetail(book.bookId)">
                    {{ book.title }}
                  </h3>
                  <div class="book-meta">
                    <span class="author" *ngIf="book.authorName">{{ book.authorName }}</span>
                    <span class="separator" *ngIf="book.authorName && book.publicationYear">•</span>
                    <span class="year" *ngIf="book.publicationYear">{{ book.publicationYear }}</span>
                    <span class="separator" *ngIf="book.publisherName">•</span>
                    <span class="publisher" *ngIf="book.publisherName">{{ book.publisherName }}</span>
                  </div>
                </div>

                                 <div class="book-status">
                   <div class="return-info" *ngIf="book.returnDate">
                     <span class="return-label">{{ 'RETURN_DATE' | translate }}:</span>
                     <span class="return-date" [class.overdue]="isOverdue(book.returnDate)" [class.warning]="isWarning(book.returnDate)">
                       {{ book.returnDate | date:'dd/MM/yyyy' }}
                     </span>
                     <span class="remaining-days" [class.overdue]="isOverdue(book.returnDate)" [class.warning]="isWarning(book.returnDate)">
                       <span *ngIf="isOverdue(book.returnDate)">
                         {{ 'OVERDUE' | translate }} {{ -getRemainingDays(book.returnDate) }} {{ 'DAYS_AGO' | translate }}
                       </span>
                       <span *ngIf="!isOverdue(book.returnDate)">
                         {{ 'REMAINING_DAYS' | translate }}: {{ getRemainingDays(book.returnDate) }} {{ 'DAYS' | translate }}
                       </span>
                     </span>
                   </div>
                 </div>
              </div>

              <!-- Book Actions -->
              <div class="book-actions">
                <button class="btn btn-outline" (click)="goToBookDetail(book.bookId)">
                  <i class="fas fa-eye"></i>
                  <span>{{ 'VIEW_DETAILS' | translate }}</span>
                </button>
                <button class="btn btn-secondary" (click)="returnBook(book.bookId)">
                  <i class="fas fa-undo"></i>
                  <span>{{ 'RETURN' | translate }}</span>
                </button>
                <button class="btn btn-primary" (click)="renewBook(book.bookId)">
                  <i class="fas fa-sync-alt"></i>
                  <span>{{ 'RENEW' | translate }}</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty Borrowed Books State -->
        <div class="empty-state" *ngIf="borrowedBooks.length === 0">
          <div class="empty-content">
            <div class="empty-icon">
              <i class="fas fa-book-open"></i>
            </div>
            <h3>{{ 'NO_BORROWED_BOOKS' | translate }}</h3>
            <p>{{ 'NO_BORROWED_BOOKS_DESCRIPTION' | translate }}</p>
            <div class="empty-actions">
              <button class="btn btn-primary" (click)="goBack()">
                <i class="fas fa-search"></i>
                {{ 'BROWSE_BOOKS' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 